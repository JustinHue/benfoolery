!function(){"use strict";!function e(){if("loading"===document.readyState)return document.addEventListener("DOMContentLoaded",e);if("auto-draft"!==document.querySelector("#original_post_status")){var t=document.querySelector("#Mgsisk_Webcomic_Transcribe_MetaBoxTranscripts .inside"),r=t.querySelectorAll("tr");!function(e){if(e.querySelector(".add-transcript"))return;var t=document.createElement("p");t.innerHTML='<a href="#" class="button add-transcript">'+webcomicTranscriptL10n.add+"</a>",t.addEventListener("click",function(t){t.preventDefault(),a(e,0)}),e.insertBefore(t,e.querySelector(".webcomic-transcripts"))}(t),QTags.addButton("comic",webcomicTranscriptL10n.comic,function(e){for(var t=e;t.tagName&&!t.classList.contains("webcomic-transcript-form");)t=t.parentNode;t.tagName&&t.classList.contains("webcomic-transcript-form")&&function(e){var t=e.querySelector(".webcomic-media");if(!t.style.display||"block"===t.style.display)return void(t.style.display="none");t.style.display=null}(t)},"","g","",0,"webcomic_transcript_content");for(var n=0;n<r.length;n++)r[n].classList.contains("none")||c(r[n])}function a(e,t){for(var r=e;r.tagName&&!r.classList.contains("inside");)r=r.parentNode;if(r.tagName&&r.classList.contains("inside")&&(r=r.querySelector("fieldset")))return o(r.parentNode,e,t);var n=new FormData,a=new XMLHttpRequest;n.append("action","webcomic_transcribe_form"),n.append("parent",document.querySelector("#post_ID").value),n.append("post",t),a.onreadystatechange=function(){if(4===a.readyState){var r,n=document.createElement("div");n.innerHTML=a.responseText,(r=n).querySelector(".button-primary").addEventListener("click",function(e){e.preventDefault(),function(e){for(var t=new FormData,r=new XMLHttpRequest,n=e.querySelector("[data-id]").getAttribute("data-id"),a=e.querySelectorAll('[type="checkbox"]'),i=[],s=0;s<a.length;s++)a[s].checked&&i.push(a[s].value);t.append("action","webcomic_transcribe_submit"),t.append("post",n),t.append("post_parent",document.querySelector("#post_ID").value),t.append("post_content",e.querySelector("textarea").value),t.append("post_status",e.querySelector(".status").value),t.append("post_languages",i),t.append("Mgsisk\\Webcomic\\Transcribe\\MetaBoxSubmitTranscriptNonce",e.querySelector('[type="hidden"]').value),r.onreadystatechange=function(){if(4===r.readyState)if(0!==r.responseText.indexOf("ERROR")){if("0"===n){for(var t=e.parentNode;t.tagName&&!t.classList.contains("inside");)t=t.parentNode;a=t.querySelector("tbody"),i=r.responseText,s=new FormData,d=new XMLHttpRequest,s.append("action","webcomic_transcribe_row"),s.append("post",i),d.onreadystatechange=function(){if(4===d.readyState&&0!==d.responseText.indexOf("ERROR")){var e=document.createElement("tbody"),t=a.querySelector("tr:last-child");e.innerHTML=d.responseText,c(e),a.insertBefore(e.children[0],a.querySelector("tr")),t.classList.contains("none")&&a.removeChild(t)}},d.open("POST",ajaxurl),d.send(s)}var a,i,s,d;e.querySelector("textarea").classList.add("saved"),o(e)}else e.querySelector(".error").innerHTML=r.responseText},r.open("POST",ajaxurl),r.send(t)}(r)}),r.querySelector(".button-secondary").addEventListener("click",function(e){e.preventDefault(),o(r)}),r.querySelector("textarea").addEventListener("keyup",function(e){"escape"===e.key.toLowerCase()&&o(r)}),r.querySelector(".webcomic-media").addEventListener("click",function(e){for(var t=e.target;t.tagName&&!t.classList.contains("webcomic-media");)t=t.parentNode;if(t.tagName&&t.querySelector("img")){if(t.classList.contains("contain"))return t.classList.remove("contain"),void(t.style.height="auto");var r=Number(t.querySelector("img").getAttribute("width")),n=Number(t.querySelector("img").getAttribute("height")),a=r/n,o=n/2*a;t.classList.add("contain"),t.style.height=o+"px"}}),r.querySelector(".webcomic-media").style.display="none",t?(e.innerHTML='<td colspan="3"></td>',e.children[0].appendChild(n)):(e.querySelector(".add-transcript").parentNode.style.display="none",e.insertBefore(n,e.querySelector(".webcomic-transcripts"))),quicktags({id:"webcomic_transcript_content",buttons:"strong,em,link,block,del,ins,ul,ol,li,code,close"}),n.querySelector("textarea").style.height=n.querySelector("textarea").scrollHeight+"px",n.querySelector("textarea").focus()}},a.open("POST",ajaxurl),a.send(n)}function o(e,t,r){var n=e.querySelector("textarea");if(n.classList.contains("saved")||n.value===n.defaultValue||window.confirm(webcomicTranscriptL10n.warn)){if(e.parentNode.classList.contains("inside"))return e.parentNode.querySelector(".add-transcript").parentNode.style.display=null,e.parentNode.removeChild(e),void(t&&a(t,r));var o=new FormData,i=new XMLHttpRequest;o.append("action","webcomic_transcribe_row"),o.append("post",e.querySelector("[data-id]").getAttribute("data-id")),i.onreadystatechange=function(){if(4===i.readyState)if(0!==i.responseText.indexOf("ERROR")){for(var n=document.createElement("tbody"),o=e;o.tagName&&"tr"!==o.tagName.toLowerCase();)o=o.parentNode;n.innerHTML=i.responseText,c(n),o.parentNode.replaceChild(n.children[0],o),t&&a(t,r)}else e.querySelector(".error").innerHTML=i.responseText},i.open("POST",ajaxurl),i.send(o)}}function c(e){e.querySelector(".quickedit a").addEventListener("click",function(e){e.preventDefault();var t=e.target.parentNode.parentNode.parentNode.parentNode;a(t,t.getAttribute("data-id"))}),e.querySelector(".trash a").addEventListener("click",function(e){var t,r,n,a,o;e.preventDefault(),t=e.target.parentNode.parentNode.parentNode.parentNode,r=new FormData,n=new XMLHttpRequest,a=t.getAttribute("data-id"),o=t.querySelector(".trash a").href,r.append("action","webcomic_transcribe_trash"),r.append("post",a),r.append("_wpnonce",o.substr(o.indexOf("_wpnonce")+9)),n.onreadystatechange=function(){4===n.readyState&&(0!==n.responseText.indexOf("ERROR")?(t.innerHTML=n.responseText,t.querySelector("a").addEventListener("click",function(e){e.preventDefault();var r=new FormData;r.append("action","webcomic_transcribe_untrash"),r.append("post",a),r.append("_wpnonce",e.target.href.substr(e.target.href.indexOf("_wpnonce")+9)),n.onreadystatechange=function(){4===n.readyState&&(0!==n.responseText.indexOf("ERROR")?(t.innerHTML=n.responseText,c(t)):t.querySelector(".js-error").innerHTML=n.responseText)},n.open("POST",ajaxurl),n.send(r)})):t.querySelector(".js-error").innerHTML=n.responseText)},n.open("POST",ajaxurl),n.send(r)})}}()}();
